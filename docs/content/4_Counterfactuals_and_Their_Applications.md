## 4 反事实及其应用

### 4.1 反事实

当我昨晚开车回家的时候，我来到了一个路口，我必须做出选择：走高速公路（ $X=1$ ）还是走维达大道（ $X=0$ ）。我最终选择了维达大道，结果发现交通非常拥堵。一小时以后我终于到家了，我对自己说：“啊，我应该选择走高速公路的！”

“我应该选择走高速公路的”这句话意味着什么呢？通俗地讲，它表示，“如果我当初选择走高速公路，我会早一点到家”。科学地来说，它意味着：在同样的那一天，在同样的环境、相同的驾驶习惯条件下，我心里估计的、走高速公路的期望驾驶时间要小于我的实际驾驶时间。

这种“如果”的陈述形式（其中“如果”部分是不真实的或者未能实现的）被称作反事实。反事实的“如果”部分称作假设条件，或者更一般地，称为前件。使用反事实来着重强调，想要在完全一致的现实条件下比较不同前件的结果（例如，行驶时间），在前面的例子中，前件是“走高速公路”，对比于“走维达大道”。已知实际决策的结果，这一事实很重要，因为在看到实际决策（走维达大道）结果后，我对于走高速公路的驾驶时间预估可能会与我知道结果前的估计完全不一样。实际决策结果（1小时）可以为走高速公路的评估提供有价值的证据，例如，那天的交通特别拥堵，这可能是由一场木丛火灾造成的。陈述“我应该走高速公路的”表达了这样的判断：无论什么情况影响了维达大道上的行驶速度，它都不会以同样的方式影响高速公路上的行驶速度。我的事后估计是，高速公路的行驶时间不超过1小时，这个估计和我在知道结果前做决策时的期望估计明显不同，否则，我会在开始时选择走高速公路。

如果尝试用，do-表达式来描述这个问题，会遇到困境，如



$$
E(\text{驾驶时间}\mid do(\text{高度公路}),\text{驾驶时间=1小时})
$$



我们想要估计的驾驶时间和观察到的实际驾驶时间之间产生了冲突。显然，要避免这个冲突，必须从符号上区分以下两个变量：

1. 实际驾驶时间；
2. 若知道走维达大道的驾驶时间为1小时，走高速公路的假设驾驶时间。

不幸的是，do-操作太笼统，无法实现这个区分。do-操作能区分两个概率： $P(\text{驾驶时间}\mid do(\text{高速公路}))$ 和 $P(\text{驾驶时间}\mid do(维达大道))$ ，但却不能区分两个变量：维达大道实际驾驶时间和高速公路假设驾驶时间。现在需要区分这两个变量，从而让实际驾驶时间（走维达大道）为估计假设驾驶时间提供信息。

幸运的是，实现这样的区分还是容易的。我们简单地使用不同的下标来标记这两个变量。用 $Y_{X=1}$ （或者 $Y_1$ ，上下文允许的话）来表示高速公路的驾驶时间，用 $Y_{X=0}$ （ $Y_0$ ）来表示维达大道的驾驶时间。针对前面的例子中，因为 $Y_0$ 是 $Y$ 实际观测值，因此希望估计的数值为



$$
E(Y_{x=1}\mid X=0,Y=Y_0=1)\tag{4.1}
$$



初学者在看到这个表达式时可能会感觉有些不适，这个表达式包含了三个变量的混合，一个假设变量和两个观察变量，假设变量 $Y_{X=1}$ 是一个事件（ $X=1$ ）上的断言，它以实际观察到的事件（ $X=0$ ）为条件。我们之前没有遇到过这样的冲突。当使用do-操作预测因果效应时，使用如下表达式：



$$
E(Y\mid do(X=x))\tag{4.2}
$$



这个表达式里的 $Y$ 是事件 $X=x$ 的结果。这个表达式也可以用新符号描述为 $E(Y_{X=x})$ ，它也表示在 $X$ 设置为 $x$ 时， $Y$ 的取值，两种表示形式都可以使用，没有必要抛弃do-操作，而仅使用反事实的符号。

我们会遇到需要使用反事实表达式（4.1）才能解决的问题，这是因为 $Y_{X=1}=y$ 一和 $X=0$ 是且一定是在不同条件下发生的事件，这两个事件发生在“不同的世界”。这样的问题不会出现在干预表示中，因为式（4.1）试图在给定实际驾驶时间（在我们选择走维达大道的世界中）为1小时的条件下，估计在选择走高速公路的世界中的驾驶时间；而式（4.2）则是在选择走高速公路的世界中估计期望驾驶时间，不参考发生在另一个世界中的任何信息。

在式（4.1）中出现的冲突使我们不能把这个表达式归约为一个do-表达式，这意味着不能从预试验中估计表达式的值。实际上，在两个决策选项上进行随机对照试验永远不会得到我们想要的估计值，这样的试验说明 $E(Y_1)=E(Y\mid do(\text{高速公路}))$ 和 $E(Y_0)=E(Y\mid do(\text{维达大道}))$ ，但是我们不能同时走高速公路和维达大道，因此无法计算我们想要的估计值，即条件期望 $E(Y_1\mid X=0,Y=1)$ 。研究者可能感兴趣是否有其他方法可以绕过这个困难，如事后专门测量高速公路时间，或者同时用另一个驾驶员，但现场条件可能随着时间发生变化，另一个驾驶员有他自己的驾驶习惯。无论哪种情况，用这些智能方法估量的驾驶时间仅是我们想要估计的“驾驶时间”的近似，随着这些条件与如果当初走高速公路的条件相似度的变化，估计的近似度也会变化。这种近似可能适合估计某些情况下的目标值，但并不适用于定义反事实。定义需要能够准确刻画我们想要做的估计，因此必须依赖下标符号 $Y_1$ ，它表示在那个特定的历史时刻我选择走高速公路的条件下，我“想要”的估计时间。

尽管式（4.1）中反事实 $Y_1$ 属于假设，但是本书第2章中的结构因果模型已证明其不仅能够用于计算任何完全确定模型的反事实摄率，也能在潜在的函数不确定或者某些变量不可测时，从数据中估计这些概率。

下一节将详细介绍计算及估计反事实的方法，之后还会用这些方法来解决各种复杂的、看起来难以解决的问题。例如，计算有多少参与者如果当初没有参加培训还能得到工作，从而识别一个工作培训项目的效应；在一个使用统一千预（将忠者组的族岛素水平控制在相同的常数值）试验中预测添加干预（对不同康岛素水平的忠者组增加5mg/l的成岛素）的效应；确定一个癌症患者如果当初选择不同的治疗方案有不同结果的可能性；以足够的概率来证明当公司拒绝应聘者时是否存在歧视现象；通过直接效应和间接效应的分析，来弄清楚不同性别的雇佣政策对于纠正劳动力中性别差异的效应。

我们可以用反事实解决所有上述问题和许多其他问题。但首先，必须学习怎样定义反事实，以及在实际中如何使用它们。

### 4.2 反事实的定义和计算

#### 4.2.1 反事实的结构性解释

在前面关于干预的章节中，通过用等式 $X=x$ 代替结构方程中的 $X$ 来模拟将变量 $X$ 设置为值 $x$ 的行为，从而用结构因果模型预测从未实施过的行动和决策的效应。本节将展示：通过在一个稍微不同的环境中使用相同的操作，我们如何使用结构方程模型来定义反事实，如何从给定模型中理解反事实，以及当模型中一部分未知时，有多大的概率能够估计出反事实。

从一个完全确定的模型 $M$ 开始，已知模型中所有外生变量的值和函数 $\{F\}$ 。在这样一个确定的模型中，每一个对于外生变量的赋值 $U=u$ 。关联到群体中的每个单个成员，或个体中的“个体”，或者关联到某种“情形”。这一关联的理由如下：每一个赋值 $U=u$ 唯一定了“中所有变量的值，因此总体中的每一个个体的属性取得唯一值，这依赖于个体的身份。如果群体是“人”，那么这些属性可能包括资历、地址、受教育情况、参加音乐活动的倾向以及在任何给定时间关联给那个个体的所有其他属性。如果群体是“农业用地”，那么属性包括土壤含量、环境气候和当地野生动物等。这些定义属性如此之多，我们不可能把所有属性都包含在模型里，但是必须把能够区别每个个体的属性全部考虑进来，这样才能确定模型里所有变量的值。从这个意义上说，每一个值对应了群体中的某个成员或“个体”，或者某种“情形”。

例如，如果 $U=u$ 代表一个名叫乔的人的属性， $X$ 代表变量“薪资”，那么 $X(u)$ 就代表了乔的薪资。如果 $U=u$ 代表了一块农业用地， $Y$ 代表了给定季节的产量，那么 $Y(u)$ 代表了那个季节 $U=u$ 该地块的产量。

现在，考虑反事实语句“在 $U=u$ 的情况下，若 $X$ 当初取值 $x$ ，则 $Y$ 会取值 $y''$ ，记做 $Y_x(u)=y$ ，其中 $X$ 和 $Y$ 是 $V$ 中的任意两个变量。解释这个句子的关键是将语句“ $X$ 当初取值 $x$ ”作为一个在当前模型中进行微小修改的陈述，以便建立前件条件 $X=x$ ，这个前件条件有可能与 $X$ 的实际观测值 $X(u)$ 冲突。这个微小修改相当于将方程中的 $X$ 替换为常量 $x$ 。可以认为是一个外部干预 $do(X=x)$ ，这个替换允许常量 $x$ 不同于 $X$ 的实际观测值（即 $X(u)$ ），而不会使方程系统不协调，用这种方式允许所有变量（包括外生变量和内生变量）都可以作为其他变量的前件。

下面在一个简单的因果模型中演示这个定义，它只包含三个变量 $X$ 、 $Y$ 、 $Z$ ，并由以下两个方程定义：



$$
X=aU\tag{4.3}
$$

$$
Y=bX+U\tag{4.4}
$$



首先计算反事实 $Y_x(u)$ ，即在 $U=u$ 的情况下，若 $X$ 当初取 $x$ ， $Y$ 的取值情况。用 $X=x$ 替换第一个方程，得到“修正”的模型 $M_x$ ：



$$
X=x
$$

$$
Y=bX+U
$$



代入 $U=u$ ，求解 $Y$ ，得到



$$
Y_x(u)=bx+u
$$



这正是我们所预期的。因为结构方程 $Y=bX+U$ 的含义是“赋值给 $Y$ 的值是加上 $X$ 赋值的 $b$ 倍”，让我们展示一个不是那么明显的结果，观察反事实 $X_y(u)$ ，即在 $U=u$ 的情况下，若 $Y$ 当初取值 $y$ 的话。 $X$ 会取什么值。这时，用 $Y=y$ 替换第二个方程，并求解 $X$ ，得到 $X_y(u)=au$ ，这意味着在假设条件“ $Y$ 当初取值 $y$ ”下， $X$ 保持不变。如果将这个假设条件看作是来自外部的、未知的干预产生的，那么似乎是可以接受的。如果不用干预的说法，而将 $Y=y$ 看作是自发的，意料之外的变化，那就可能不是我们期望的了。无论 $Y$ 的变化是外部产生的还是自发产生的， $X$ 都不会发生变化，反事实条件下的 $X$ 不变性反映了这样一种直觉：假设的未来事件并不会改变过去。

对应于模型中变量可以取得的不同值，每个结构方程模型都包含许多这样的反事实。为了展示这个模型隐含的其他反事实，现假设式（4.3）和式（4.4）中的 $U$ 可以取三个值 $1,2,3$ ，并令 $a=b=1$ 。表4.1给出了对应 $x$ 和 $y$ 不同水平的 $X(u), Y(u),Y_X(u)$ 和 $X_y(u)$ 的取值。例如，为了计算 $u=2$ 时的 $Y_2(u)$ ，只需要 $X=2$ 替换 $X=aU$ ，求解一组新的方程，然后得到 $Y_2(u)=2+u=4$ 。这个计算非常简单，其足以表明虽然反事实被认为是假设的，甚至从统计角度看是神秘的，但它们很自然地从我们对现实的感知中表现出来，就像在结构模型中表现的那样。每一个结构方程模型都为所有可能的反事实赋予了确定的值。

表4.1 对式（4.3）和式（4.4）线性模型取值情况

| $u$  | $X(u)$ | $Y(u)$ | $Y_1(u)$ | $Y_2(u)$ | $Y_3(u)$ | $X_1(u)$ | $X_2(u)$ | $X_3(u)$ |
| ---- | ------ | ------ | -------- | -------- | -------- | -------- | -------- | -------- |
| 1    | 1      | 2      | 2        | 3        | 4        | 1        | 1        | 1        |
| 2    | 2      | 4      | 3        | 4        | 5        | 2        | 2        | 2        |
| 3    | 3      | 6      | 4        | 5        | 6        | 3        | 3        | 3        |

从这个例子中，读者可能会得到这样的印象：反事实与待通的由 do-操作刻画的干预措施没有区别。然而，需要注意的是，在这个例子中，我们计算的不仅仅是 $Y$ 在这样或那样干预下的概念或期望值，而且还计算了 $Y$ 在假设的新条件 $X=x$ 下的值。对于每一种情况 $U=u$ ，得到了一个确定的数值 $Y_x(u)$ ，它代表了 $Y$ 在这种情况下的假设值。另一方面，do-操作仅仅根据定义在从来积分类（式（1.30））中删除因子 $P(x_i\mid pa_i)$ 之后的概率分布，提供了如 $E(Y\mid do(x))$ 这样的概率结果。从实验主义的角度来看，这一差异反映了计算总体水平和个体水平之间的巨大鸿沟：do(x)-操作刻画了干预下的总体行为，而 $Y_x(u)$ 描述了一个特定的个体在这样一个干预下的行为。这一差异具有意义深远的影响，将使我们能够定义诸如信任、过失和遗憾等概念的概率，而这些都是 do-操作无法刻画的。

#### 4.2.2 反事实的基本定理

现在，可以将反事实的概念推广到任何结构模型 $M$ 。考虑任意两个变量 $X,Y$ ，它们不一定在同一个方程里（但在同一个方程组里）。令 $M_x$ 表示用 $X=x$ 代替 $X$ 后得到的 $M$ 的修改版。反事实 $Y_x(u)$ 的形式化定义为


$$
Y_x(u)=Y_{M_x}(u)\tag{4.5}
$$


用语言描述为：模型 $M$ 中的反事实 $Y_x(u)$ 被定义为“修改后的”子模型 $M_x$ 中 $Y$ 的解。式（4.5）是因果推理最重要的基本原则之一。它使我们获得具有现实意义的科学概念，并用它来回答大量类似于“若当初取值 $x$ ， $Y$ 会取什么值”的各种问题。当 $X$ 和 $Y$ 是变量集合时，如果 $M_x$ 表示 $X$ 集合中所有成员均被常数值替换后的模型，定义同样适用。这带来了大量的、可由给定模型计算的反事实语句，并引出了一个有趣的问题：这样一个由几个方程组成的简单模型，怎么会有如此多的反事实赋值？答案是：这些反事实得到的值并不是完全任意的，而是必须相互一致的，并且与一个基础模型相协调。

例如，如果观察到 $X(u)=1$ 和 $Y(u)=0$ ，那么 $Y_{X=1}(u)$ 一定是0。这是因为将 $X$ 设定为一个已经存在的值 $X(u)=1$ ，不应该对世界产生任何改变。因此， $Y$ 应当保持当前的值 $Y(u)=0$ 。

一般来说，反事实遵循以下的一致性原则：


$$
\text{如果}\quad X=x\quad\text{那么}\quad Y_x=Y\tag{4.6}
$$


如果 $X$ 是二值的，那么一致性原则变为


$$
Y=XY_1+(1-X)Y_0
$$

这可以解释如下： $Y_1$ 为 $X$ 取值为1时候的 $Y$ 的观察值。对应地， $Y_0$ 为 $X$ 取值为0时候的 $Y$ 的观察值，如果通过式（4.5）计算反事实，那么所有这些约束都会自动成立。

#### 4.2.3 从总体数据到个体数据行为

为了显示反事实个体行为推理中的作用，使用图4.1中描述的模型加以说明。图4.1表示一个“激励方案”：即表示一个学生在课后补习班上花费的时间， $H$ 表示家庭作业量， $Y$ 表示考试成绩。每一个变量的值以超出学生考试成绩均值的标准差来表示（即模型是标准化的，所有的变量均值为0，方差为1）。例如，如果 $Y=1$ ，那么学生得分超出考试成绩均值的1个标准差。这个模型表示一个随机试点项目，学生们被随机地指定参加课后补习。图4.1对应模型描述见“模型4.1”。

![fig_4.1](../images/fig_4.1.png)

模型4.1
$$
X=U_X
$$

$$
H=aX+U_H
$$

$$
Y=bX+cH+U_Y
$$

$$
\sigma_{U_iU_j}=0,\quad\text{对于所有}i,j\in\{X,H,Y\}
$$

假设所有的因子 $U$ 都是独立的，且得到了模型4.1中系数的值（这些值可以从总体数据中估计得到）：
$$
a=0.5,b=0.7,c=0.4
$$

考总一个名为乔的学生，测得： $X=0.5,H=1,Y=1.5$ 。假设希望回答以下问题：如果乔当韧的家庭作业量加倍，他的分数会是多少呢？

在线性结构方程模型中，每个变量的值均由系数和变量 $U$ 确定，后者表示了个体之间的差异。因此，可以使用证据 $X=0.5,H=1$ 以及 $Y=1.5$ ，确定与乔相关的变量 $U$ 的值。这些值对于假设的行为是不变的，比如那些可能使乔家庭作业量加倍的行为。

这种情况下，能够从证据中获得乔的特定 $U$ 值：

$$
U_X=0.5
$$

$$
U_H=1-0.5\times0.5=0.75
$$

$$
U_Y=1.5-0.7\times0.5-0.4\times1=0.75
$$

接下来，用 $H=2$ 替换 $H$ 的结构方程，模拟将乔的家庭作业量加倍的行为。图4.2描述了修改后的模型，最后，在修改后的模型中用计算后的 $U$ 值来计算 $Y$ 的值，得到
$$
\begin{aligned}
Y_{H=2}(U_X&=0.5,U_H=0.75,U_Y=0.75)\\
&=0.5\times0.7+2.0\times0.4+0.75\\
&=1.90
\end{aligned}
$$

因此得出了如果乔的家庭作业量增加一倍，则他的分数会变为1.9而不是1.5。根据之前的约定，这意味着增加到比均值高1.9个标准差，而不是现在的1.5个标准差。

![fig_4.2](../images/fig_4.2.png)

上述过程可总结为：首先应用证据 $X=0.5,H=1$ 以及 $Y=1.5$ 去获取变量 $U$ 的值；然后通过 $H=2$ 替换方程 $H=aX+U_H$ ，来模拟一个外部干预从而强制条件 $H=2$ ；最后，在给定的结构方程和获取的取值条件下计算 $Y$ 的值（当然，在上面的所有情况下，假设对 $H$ 的干涉不会改变 $U$ 的值）。

#### 4.2.4 计算反事实的三个步骤

乔的课后补习项目的例子展示了反事实的基本定义，以及如何获得给定反事实值的过程。任何反事实值的确定可由如下三步过程来计算：

(i)溯因：用证据 $E=e$ 来确定 $U$ 的值；

(ii)作用：修改模型 $M$ ，移除变量 $X$ 出现在左边的方程，用 $X=x$ 来替换它们，从而获得修正的模型 $M_x$ ；

(iii)预测：使用修改后的模型 $M_x$ 和 $U$ 的值来计算 $Y$ 的值，即反事实的结果。

做一个时间上的比喻，步骤（i）根据当前证据 $e$ 解释过去（ $U$ ）；步骤（ii）通过（最低限度的）扭曲历史来符合假设的前件 $X=x$ ；步骤（iii）根据对过去的认识和新立的条件 $X=x$ 来预测未来（ $Y$ ）。

这个过程可以解决任何确定性的反事实问题，即已知每个相关变量值的总体中与个体有关的反事实问题，结构方程模型能够回答这种性质的反事实问题，因为每个方程都表示一个变量获得其值的方式。如果我们知道这些方式，也就应该能够预测给定修改条件下，某些方式被改变后变量将会得到什么值。因此，将反事实视作是结构方程的衍生性质是很自然的。在一些框架中，反事实被当作本原性质（Hallamd, 1986；Rubin, 1974）。

但反事实是可论是以某概率发生的，这与总体中的一类个体有关。例如，在课后补习项目的例子中，可能想知道如果令所有 $Y<2$ 的学生当初的家庭作业量加倍，会发生什么。这些概率性的反事实与do-操作干预不同，因为它们限制了施加干预的个体集合，而do-表达式不能这样做。

现在可以将确定性模型改进为概率性模型来处理关于反事实的概率和期望的问题。例如，假设乔是一名参与了图4.1项目的学生，他的考试分数为 $Y=y$ 。如果当初增加5个小时的激励训练，那么他的分数是 $Y=y’$ 的概率是多少？或者，在这样一个假设世界中，他期望的分数是多少？与模型4.1不同，我们没有关于所有三个变量 $\{X,Y,H\}$ 的信息，因此不能唯一地确定与乔相关的值 $u$ 。相反，乔可能属于一个与证据相对应的个体分组，组内每个个体具有不同的 $u$ 值。

我们可以通过为外生变量 $U$ 赋饱和率 $P(U=u)$ ，将不确定性引入因果模型。它们代表了我们对于识别对象的不确定性，或者，当对象已知时，对于问题中可能包含的对象的其他属性的不确定性。

外生点率 $P(U=u)$ 在内生变量 $V$ 上引入了唯一的概率分布 $P(V)$ 。在这个分布的帮助下，我们不仅可以定义和计算任何一个反事实 $Y_x=y$ 的概率，还可以定义和计算观测变量及反事实变量所有组合的联合分布。例如，可以确定 $P(Y_x=y,Z_x=z,X==x')$ ，其中 $X,Y,Z$ 和 $W$ 是模型中的任意变量。这样的联合概率表示某些 $u$ 的比例，即括号内的所有事件对于这些 $u$ 都是事实的，满足 $Y_x(u)=y$ 和 $Z_w(u)=z$ 以及 $X(u)=x'$ ，特别是，允许 $w$ 或者 $x'$ 与 $x$ 冲突。

关于这些概率的一个典型问题是：假定我们观察到给定个体的特征 $E=e$ ，那么如果 $X$ 当初取值 $x$ ，我们对于这个个体的 $Y$ 的期望值是多少？这个期望表示为 $E(Y_{X=x}\mid E=e)$ 。其中，允许 $E=e$ 与前件 $X=x$ 冲实。竖线后的 $E=e$ 代表了我们在这个个体上所获得的所有的信息（或证据），可能包括 $X,Y$ 或其他变量的值，就像在式（4.1）中看到的那样。下标 $X=x$ 表示了由反事实语句所确定的前件。 

在接下来的章节中会介绍处理这些概率和期望的细节。但是目前知道如何使用它们很重要，可以将之前的三步法扩展到任何概率型的非线性系统。

给定任何一个形式为 $E(Y_{X=x}\mid E=e)$ 的反事实，三步法过程如下：

（i）溯因：根据证据更新 $P(U)$ ，获得 $P(U\mid E=e)$ ；

（ii）作用：修改模型 $M$ ，移除 $X$ 出现在左边的结构方程，用 $X=x$ 来替换它们，从而获得修正的模型 $M_x$ ；

（iii）预测：使用修正的模型 $M_x$ 和 $P(U\mid E=e)$ ，计算 $Y$ 的期望，即反事实的结果。

我们将在4.4节中看到，以上的过程不仅适用于回顾性的反事实问题（形式为“如果 $X$ 当初取值 $x$ ， $Y$ 的值会是多少？”的问题），还适用于某些前瞻性问题。特别地，若让每个个体都实施一个依赖于它的 $X$ 当前值的行为，该方法也适用。一个典型的例子是“添加干预”，例如，不管患者之前的剂量如何，均对每个患者增加5 mg/L的胰岛素。由于最终胰岛素水平根据患者的不同而不同，因此这个措施不能用do-表达式来表示。

另一个例子是，假设想要使用图4.1来估计一项学校政策对考试成绩的效应，该政策是令懒得做作业（ $H<H_0$ ）的学生参加课后补习项目（ $X=1$ ）。我们不能简单地干预 $X$ ，使其在 $H$ 低的情况下等于1，因为在该模型中， $X$ 是 $H$ 低的原因之一（参见图4.1）。

相反，我们用反事实符号表示这个量的期望，即 $E(Y_{X=1}\mid H\le H_0)$ ，原则上，它可以使用上述三步法来计算。在用由特征表示的总体子集估计行为和政策效应时，如果这些特征受政策的影响（如 $H\le H_0$ ），那么反事实推理和上述过程是必需的。

### 4.3 非确定性的反事实

#### 4.3.1 反事实的概率

为了说明非确定性是如何体现在反事实计算中的，让我们给公式（4.3）和（4.4）中的变量 $U$ 的值赋予概率。设想 $U=\{1, 2, 3\}$ 代表了总体中的三种类型的个体，概率如下：


$$
P(U=1)=\frac{1}{2},P(U=2)=\frac{1}{3},P(U=3)=\frac{1}{6}
$$

所有在同一总体类型中的个体有相同的反事实值，正如表4.1中对应行所确定的。使用这些值，可以计算满足指定条件的反事实的概率，例如，可以计算若 $X$ 当初取值为2， $Y$ 的值会是3的个体的比例，或者 $Y_2(u)=3$ 。这个条件仅发生在表的第一行，因为它是 $U=1$ 的一个属性，所以可以得出结论：它的发生概率为1/2，即 $P(Y_2=3)=1/2$ 。同样可以计算其他反事实的概率，例如， $P(Y_1=4)=1/6,P(Y_1=3)=1/3,P(Y_2>3)=1/2$ 等。然而，值得注意的是，也可以计算每一个反事实事件和观察事件组合的联合概率，例如：
$$
P(Y_2>3,Y_1<4)=1/3
$$

$$
P(Y_1<4,Y-X>1)=1/3
$$

$$
P(Y_1<Y_2)=1
$$

在第一个表达式中，我们发现了两个发生在不同世界中的事件的联合概率： $Y_2>3$ 发生在 $X=2$ 的世界中， $Y_1<4$ 发生在 $X=1$ 的世界中。它们联合的概率为1/3，这是因为这两个事件仅在 $U=2$ 时才能共同发生，而 $U=2$ 的概率为1/3。第二个和第三个表达式展示了其他跨越世界的事件。值得注意的是，不同世界之间的冲突不会为计算设置障碍。实际上，跨越世界的概率计算正如在相同世界内计算那样简单：简单地确定那些特定组合条件为真的行，然后将这些行的概率加起来，这使我们具有在反事实中计算条件概率和定义相关概念的能力，例如反事实中的变量依赖和条件独立，正如在第1章中处理观察变量时所做的那样。例如，很容易验证，在 $Y>2$ 的个体中，如果 $X$ 当初取 3， $Y$ 会增加的概率为 2/3。因为 $P(Y_3>Y\mid Y>2)=\frac{1}{3}/\frac{1}{2}=\frac{2}{3}$ 。同样地，可以验证差值 $Y_{x+1}-Y_x$ 与 $x$ 独立，这意味着 $X$ 对 $Y$ 的因果效应不会随着总体类型的变化而变化，这是一个所有线性模型都具有的性质。

这种多个世界中的反事实联合概率可以很容易地用下标符号来表示，如 $P(Y_1=y_1,Y_2=y_2)$ ，且能够从结构模型中计算，正如表4.1那样，然而，它们不能用 do(x) 符号来表示，因为后者仅能为每一个干预 $X=x$ 计算一个概率。为了了解这个局限带来的问题，我们来研究一个对式（4.3）和式（4.4）中模型进行轻微改动形成的模型。新模型的方法如下：

$$
X=U_1,Z=aX+U_2,Y=bZ\tag{4.7}
$$
图 4.3 给出了其结构。为了让这个模型符合所讨论的问题，令 $X=1$ 表示受过高等教育， $U_2=1$ 表示有工作经验， $Z$ 表示给定工作所需的技能水平， $Y$ 表示薪资。

![fig_4.3](../images/fig_4.3.png)

假设我们的目标是计算 $E(Y_{X=1}\mid Z=1)$ ，它表示技能水平 $Z=1$ 的个体如果当初接受了高等教育的话，他们薪资的期望值。这个统计量不能用do-表达式描述，因为条件 $Z=1$ 和前件 $X=1$ 属于两个不同的世界；前者表示当前的技能，而后者表示在非现实的过去中的一个假设教育。如果试图用表达式 $E(Y\mid do(X=1), Z=1)$ 来描述这个假设的薪资，是无法揭示我们想要的信息的。do-表达式表示所有完成了高等教育并且之后获得了技能水平 $Z=1$ 的个体的期望薪资，如图4.3所示，这些个体的薪资仅依赖于他们的技能水平，技能来自高等教育还是工作经验并不会影响他们的薪资。在这种情况下，条件 $Z=1$ 切断了我们感兴趣的干预效应。与之相反，在那些当前 $Z=1$ 的个体中，某些个体可能没有接受过高等教育，如果他们当初接受了高等教育的话，他们会获得更高的技能水平（及薪资），我们感兴趣的是这些人的薪资，但是这没有被包含在do-表达式中。因此，在这种情况下，do-表达式不能刻画反事实问题。
$$
E(Y\mid do(X=1),Z=1)\neq E(Y_{X=1}\mid Z=1)\tag{4.8}
$$

我们可以进一步证实这个不等式，方法是观察如下事实：当 $E(Y\mid do(X=1),Z=1)$ 等于 $E(Y\mid do(X=0),Z=1)$ 时， $E(Y_{X=1}\mid Z=1)$ 不一定等于 $E(Y_{X=0}\mid Z=1)$ 。将 $Z=1$ 看作干预后条件，在两个前提条件下所满足的两个不同的个体集合（即 $X=1$ 的人群和 $X=0$ 的人群）；而后者是当前世界中定义的单独个体集合（即 $Z=1$ 的人群），该集合中的个体在两个不同的假设前提下会有不同的结果。 $do(x)$ 符号不能描述后者，这是因为表达式 $E(Y_{X=1}\mid Z=1)$ 中的事件 $X=1$ 和 $Z=1$ 指的是干预前和干预后两个不同的世界。另一方面，表达式 $E(Y\mid do(X = 1),Z=1)$ 仅仅表示干预后的事件，这就是为什么它可以用 $do(x)$ 来表述的原因。

一个很自然的问题是：反事实符号是否也能用于描述干预后的事件，即单一世界的表达式 $E(Y\mid do(X = 1), Z = 1)$ 。答案是肯定的，反事实符号更灵活，既能刻画单一世界，又能描述跨世界的事件概率。 $E(Y\mid do(X=1),Z=1)$ 可以很容易地转化为反事实表达： $E(Y_{X=1}\mid Z_{X=1}=1)$ ，它显式地将事件 $Z = 1$ 指定为干预后的事件。变量 $Z_{X=1}$ 表示 $X$ 如果取值为1时 $Z$ 的取值，这正是我们之前在用贝叶斯公式将 $Z = z$ 加入表达式时想要表达的：
$$
P(Y=y\mid do(X=1),Z=1)=\frac{P(Y=y,Z=z\mid do(X=1))}{P(Z=z\mid do(X=1))}
$$

这明确地说明了 $Z$ 对 $X$ 的依赖应该如何处理。在3.5节的特别例子中，作为年龄变量 $Z$ 在干预前和干预后是不变的，因此有 $Z_{X=1}=Z$ ，在这种情况下不需要区分两者（即干预前和干预后），式（4.8）中的不等号将变为等号。

下而分析这个逻辑是如何反映在数字上的。表4.2描述了与式（4.7）对应模型相关的反事实，其中所有的下标表示 $X$ 的状态，这个表是用构建表4.1的方法构建的：用适当的常数（0或1）来替换方程 $X=u$ ，然后求解 $Y$ 和 $Z$ 。使用这个表，能够立即验证：

表4.2 对式（4.7）模型取值情况

| $u_1$ | $u_2$ | $X(u)$ | $Z(u)$ | $Y(u)$ | $Y_0(u)$ | $Y_1(u)$ | $Z_0(u)$ | $Z_1(u)$ |
| ----- | ----- | ------ | ------ | ------ | -------- | -------- | -------- | -------- |
| 0     | 0     | 0      | 0      | 0      | 0        | ab       | 0        | a        |
| 0     | 1     | 0      | 1      | b      | b        | (a+1)b   | 1        | a+1      |
| 1     | 0     | 1      | a      | ab     | 0        | ab       | 0        | a        |
| 1     | 1     | 1      | a+1    | (a+1)b | b        | (a+1)b   | 1        | a+1      |

$$
E(Y_1\mid Z=1)=(a+b)b\tag{4.9}
$$

$$
E(Y_0\mid Z=1)=b\tag{4.10}
$$

$$
E(Y\mid do(X=1),Z=1)=b\tag{4.11}
$$

$$
E(Y\mid do(X=0),Z=1)=b\tag{4.12}
$$

这些方法提供了对式（4.8）中不等式的数值验证。它们也说明了一个我们之前就注意到的反事实的独特性质，虽然在图4.3的图模型中 $Z$ 分离了 $X$ 和 $Y$ ，但我们发现对于那些符合条件 $Z=1$ 的个体， $X$ 对 $Y$ 是有效度的。

$$
E(Y_1-Y_0\mid Z=1)=ab\neq 0
$$
这可以由薪资的例子给出完美的解释。对于那些已经获得技能水平 $Z=1$ 的个体，他们的薪资仅依赖于他们的技能，而不是 $X。$ 对于那些当前技能水平 $Z=1$ 的个体，如果他们有不一样的过去，那么他们的薪资会变得不同。这种类型的回顾性推理，惯于对非现实历史的依赖，但并没有在如图4.3所示的图模型中表示出来。为了实现这样的推理，我们需要设计能直接在图中表示反事实的方法，将在4.3.2节给出这样的表示。

到目前为止， $P(u_1)$ 和 $P(u_2)$ 概率值还没有用于计算，因为条件 $Z=1$ 仅发生在 $u_1=0$ 且 $u_2=1$ 时（假定 $a\neq 0$ 且 $a\neq 1$ ），这时每一个 $Y,Y_1$ 和 $Y_0$ 都有确定值。然而，如果假设模型中 $a=1$ ，那么这些概率就会发挥作用，因为现在 $Z=1$ 可以发生在两个条件下：（ $u_1=0,u_2=1$ ）以及（ $u_1=1,u_2=0$ ）。每一个发生的概率为 $P(u_1=0)\cdot P(u_2=1)$ ，第二个发生的概率为 $P(u_1=1)P(u_2=0)$ 。在这种情况下，有
$$
E(Y_{X=1}\mid Z=1)=b(1+\frac{P(u_1=0)P(u_2=1)}{P(u_1=0)P(u_2=1)+P(u_1=1)P(u_2=0)})\tag{4.13}
$$

$$
E(Y_{X=0}\mid Z=1)=b(1+\frac{P(u_1=0)P(u_2=1)}{P(u_1=0)P(u_2=1)+P(u_1=1)P(u_2=0)})\tag{4.14}
$$

式（4.13）大于式（4.14）的事实再一次说明受教育程度对薪资的技能-特定因果效应不为 0，薪资仅由技能决定，而非教育。这是可以预料到的，因为技能水平 $Z=1$ 的雇员中没有接受高等教育的雇员比例不为零，他们如果当初接受了高等教育的话，他们的技能水平会增加到 $Z_1=2$ ，他们的薪资会达到 $2b$ 。

#### 思考题 4.3.1

考虑如图 4.3 所示模型，假定 $U_1$ 和 $U_2$ 是两个独立的高斯变量，每一个都是零均值和单位方差。

（a）对于技能水平 $Z=z$ 的雇员，如果他们当初接受了 $x$ 年的高等教育，计算他们的期望薪资。[提示：使用定理 4.3.2 的公式，其中证据 $e:Z=z$ ，并使用事实：对于任意两个高斯变量（设为 $X$ 和 $Z$ ），有 $E(X\mid Z=z)=E(X)+R_{XZ}(z−E(Z))$ 。使用第 3.8.2 节和第 3.8.3 节的知识，以结构参数的形式表示所有的回归系数，得到 $E(Y_x\mid Z=z)=abx+bz/(1+a^2)$ 。]

（b）基于（a）的答案，说明受教育程度对薪资的技能-特定因果效应独立于技能水平。

#### 4.3.2 反事实的图形化表示

由于反事实是结构方程的副产品，那么一个很自然的问题是：能否在与这些模型相关联的因果图中理解它们？答案是肯定的，正如可以从式（4.5）的反事实基本原理中理解它们一样。这个原理说明：如果修改模型 $M$ 得到子模型 $M_x$ ，那么修改后的模型中的结果变量 $Y$ 就是原始模型的反事实 $Y_x$ 。由于模型修改要求移除所有指向 $X$ 的箭头，因此能够得出结论，如图4.4所示：与变量 $Y$ 关联的节点若换为与 $Y_x$ （表示在 $X = x$ 情况下的潜在结果）关联，这个替换仅在修改后的模型中成立。

![fig_4.4](../images/fig_4.4.png)

这个反事实的形象化表示足够回答一些关于 $Y_x$ 的统计性质的基本问题，以及这些性质如何依核干模型中的共他变量，特别是当以这些变量为条件时。

在讨论 $Y_x$ 的统计属性时，需要探究是什么引起了 $Y_x$ 的变化。根据它的结构性定义， $Y_x$ 表示了在 $X$ 被限定为常数 $X = x$ 时的值。因此，当 $X$ 被固定为常数时，即当移除指向 $X$ 的箭头时，如图4.4(b)所示， $Y_x$ 在统计上的变化受所有能够影响 $Y$ 的外生变量所支配。在这样的条件下，能够传递变化给 $Y$ 的变量集合是 $Y$ 的父节点（观察到的或未观察到的），以及 $X$ 到 $Y$ 路径上节点的父节点。例如，在图4.4(b)中，这些父节点是： $\{Z_3,W_2,U_3,U_Y\}$ ，其中 $U_Y$ 和 $U_3$ 是 $Y$ 和 $W_3$ 的误差项，它们没有显示在图中。任何阻断 $X$ 到这些父节点路径的变量集合也阻断了到 $Y_x$ 的路径，因此导致 $Y_x$ 条件独立。特别地，如果有一个变量集合 $Z$ 满足模型 $M$ 中的后门准则（见定义 3.3.1），那么这个集合也阻断了所有 $X$ 到这些父节点之间的路径，因此会使 $X$ 和 $Y_x$ 对于每一个 $Z = z$ 的情况均（条件）独立。

这次考虑被形式化总结为定理4.3.1。

**定理 4.3.1（后门的反事实解释）** 如果一个变量合 $Z$ 满足 $(X,Y)$ 的后门条件，那么对于所有的 $x$ ，在给定 $Z$ 条件下，反事实 $Y_x$ 条件独立于 $X$ ，记为
$$
P(Y_x\mid X,Z)=P(Y_x\mid Z)\tag{4.15}
$$
当需要从观察研究中估计反事实的概率时，定理 4.3.1 会非常有价值。特别是，它表明 $P(C \mid Y = y)$ 可由校正公式（3.5）计算。为了证明这一点，以 $Z$ 为条件（如公式（1.9）中那样），得到
$$
\begin{aligned}
P(Y_x=y)&=\sum_zP(Y_x=y\mid Z=z)P(z)\\
&=\sum_zP(Y_z=y\mid Z=z,X=x)P(z)\\
&=\sum_zP(Y=y\mid Z=z,X=x)P(z)
\end{aligned}
\tag{4.16}
$$

第二行由定理4.3.1获得，第三行由一致性规则（式（4.6））获得。

在式（4.16）中得到了熟悉的校正公式，这并不令人惊讶，因为同样的公式在3.2节（式（3.4））对 $P(Y=y \mid \text{do}(x))$ 的推导中也得到过， 我们知道 $P(Y_x=y)$ 只是 $P(Y=y \mid \text{do}(x))$ 的另一个表达式是一样的。有趣的是，这个推导只引用了代数形式。一旦确定 $Z$ 满足后门准则，那么这个推导就可以不借助模型。式（4.15）将图形化表示转化为代数形式，进而推导出式（4.16），有时也称其为“（ $X$ 的）条件可忽略性”。定理4.3.1给出了这个概念的科学表述，我们可以测试它是否在任何给定的模型中都成立。

使用反事实的图形化表示，可以解决在4.3.1节（图4.3）中所面临的困境，图形化地解释了为什么较强的受教育程度（ $X$ ）会对耳前处于技能水平 $Z=z$ 的人的薪资（ $Y$ ）产生影响，尽管根据模型，薪资仅由技能水平决定。要形式化地检测受教育程度对薪资（ $Y_x$ ）的效应是否统计上独立于受教育程度，我们需要在图中找到 $Y_x$ ，看它是否在给定 $Z$ 的条件下与 $X$ 是“d-分离”的。参考图4.3可以看到， $Y_x$ 可由 $U_2$ 确定， $U_2$ 是从 $X$ 到 $Y$ 的因果路径上节点的唯一父节点（因此当 $X$ 被固定为常量时，它是唯一能令 $Y_x$ 产生变化的变量）。图4.3告诉我们 $Z$ 是 $X$ 和 $U_2$ 的对撞节点。因此，在给定 $Z$ 的条件下， $X$ 和 $U_2$ （类似地， $X$ 和 $U_2$ ）不是“d-分离”的。因此可得出结论。

$$
E(Y_x\mid X,Z)\neq E(Y_x\mid Z)
$$
尽管有
$$
E(Y\mid X,Z)=E(Y\mid Z)
$$

在思考题4.3.1中，我们在线性⾼斯模型的条件下明确地估计了反事实的期望。在这一节中建立的图形化表示允许我们通过图形化的方法来确定反事实中的独立性，而不用假设线性或任何特定的参数形式。这是将现代因果分析引入统计学的⼯具之一，从前面对如图4.3所示模型的分析可以看出，这是一个难以通过直觉解决的任务，但可以将其简化为关于图的简单操作。Pearl（2000:213-215）中讨论了其他与可祝化反事实相关的方法，名为“孪⽣⽹络”。

#### 4.3.3 试验环境中的反事实

我们已经相信每一个反事实向题都能够从完全确定的结构模型中获得回答，接下来我们考虑试验环境，在该情况下可能无法得到完整的模型，试验者必须通过观察有限的样本来回答干预向题。现在回到图4.1的“激励方案”模型，分析一个学生乔的个体行为，并假设试验者观察了10个这样的个体的集合，乔是参与者1号，每个个体由一个单独的向量刻画： $U_t=(U_X,U_W,U_Y)$ ， $U_t$ 服从 $[0,1]$ 上的均匀分布，正如在表4.3的前三列中展示的。

表4.3 根据图4.1中的结构模型预测得到的潜在的和观察的结果

![tab_4.3](../images/tab_4.3.png)

使用这个信息，可以创建一个符合模型要求的完整数据集。对于每个三元组 $(U_X,U_H,U_Y)$ ，图4.1的模型使我们能够给出表中一整行的数据，包括 $Y_0$ 和 $Y_1$ ，这二者分别代表了试验（ $X=1$ ）和控制（ $X=0$ ）条件下的潜在结果。图4.1的结构模型实际上表示了一个模拟的个体群体，以及群体在观察及试验条件下的预测行为。标记为 $Y_0,Y_1,H_0,H_1$ 的列预测了两种处理方式下（ $X=0$ 和 $X=1$ ）的假设结果。例如， $Y_{X=0.5,Z=2.0}$ ，如同在图4.2中为乔计算的，当然也包括其他所有可能的下标组合。从这个模拟的群体中，人们能够估计变量 $X,Y,H$ 上的每一个反事实问题的概率，前提是假设我们有表中所列的所有数据。这个估计只需简单地统计满足给定要求的个体比例，如同在4.3.1节中演示的那样。

毋庸置疑的是，无论是在观察研究中还是在试验研究中，都不能完整获得像表4.3这样的数据。这些数据是从诸如图4.2的参数化模型中推导出来的。从该模型中，能够在给定观察 $\{X,Y,Z\}$ 的条件下推导每一个参与者的属性 $\{U_X,U_H,U_Y\}$ 。一般而言，如果缺少参数化模型，仅仅观察他们的行为 $\{X,Y,Z\}$ 时，我们几乎无法知道任何个体参与者的潜在结果 $Y_1$ 和 $Y_0$ 。从理论上讲，我们仅有的反事实 $\{Y_1,Y_0\}$ 与观察数据 $\{X,Y,Z\}$ 之间的联系是公式（4.6）中的一致性原则，该原则说明，当 $X=1$ 时， $Y_1$ 一定等于 $Y$ ，当 $X=0$ 时， $Y_0$ 一定等于 $Y$ 。除了这个简单的联系外，与个体参与者有关的大部分反事实将无法被观测。

幸运的是，我们可以在样体水平上了解许多关于这些反事实的信息，例如估计它们的概率和期望。通过式（4.16）的校正可以仅使用图计算 $E(Y_1-Y_0)$ ，而不需要完整的模型。还可以从试验研究中获得更多的信息，有时候图本身甚至可以是可有可无的。

假设没有关于潜在模型的任何信息，仅有试验研究中 $Y$ 的观测值，其中， $X$ 随机在两个水平取值， $X=1$ 和 $X=0$ 。

表4.4描述了相同的10个参与者（乔是参与者1号）在这样的试验条件下的结果， $X$ 在 $X=0$ 和 $X=1$ 上随机分布，其中参与者 $1,5,6,8,10$ 被赋予 $X=0$ ，其余为 $X=1$ 。前两列给出了真实的潜在结果（从表4.3中获益），而最后两列描述了试验者所能获得的信息，其中黑色方块表示结果未被观察到。显然， $Y_0$ 仅能在被赋予 $X=0$ 的参与者中观察到，类似地， $Y_1$ 仅能在被赋予 $X=1$ 的参与者中观察到。随机化能够确保，虽然一半的潜在结果无法观测，但试验组与对照组的观测均值差异会收敛到群体均值的差异， $E(Y_1−Y_0)=0.9$ 。这是因为随机化能够使黑色方块在表4.4的最右两列中随机分布，并独立于 $Y_0$ 和 $Y_1$ 的值，因此随着样本数目的增多，样本均值会收敛到群体均值。

![tab_4.4](../images/tab_4.4.png)

随机试验的这个独特而重要的性质其实并不陌生，因为随机化像干预一样，使得 $X$ 独立于任何可能影响 $Y$ 的变量，如图4.4（b）所示。在这样的条件下，可以令 $Z=\emptyset$ ，应用校正公式（4.16），得到 $E(Y_x)=E(Y\mid X=x)$ ，其中 $x=1$ 代表处理过的个体， $x=0$ 表示未被处理的个体。表4.4帮助我们理解从试验中获取样本均值时，实际上计算的是什么，以及这个均值如何与潜在的反事实 $Y_0$ 和 $Y_1$ 发生联系。

#### 4.3.4 线性模型中的反事实

在非参数化模型中，即使做了大量的试验，形式为 $E(Y_{X=x}\mid Z =z)$ 的反事实的值也可能无法识别。然而，在完全的线性模型中，事情要简单得多。只要能够识别模型参数，任何反事实的也都是可以识别的。这是因为，参数完全定义了模型的函数，正如之前看到的，一旦函数确定了，那么反事实就可以用公式（4.5）来计算。因为每个模型参数都可以用直接因果效应的干预来确定。因此可以得出结论，在线性模型中，每一个反事实都是试验可识别的。那么问题变为，当某些模型参数不能识别时，反事实是否可以在观察研究中被识别出来？事实证明，只要 $E[Y \mid do(X = x)]$ 可识别，那么任何形如 $E(Y_{x} \mid Z = e)$（其中 $e$ 是一个任意的证据集合）的反事实均可被识别（Pearl, 2000:389）。定理4.3.2总结了二者之间的关系，它提供了一种计算反事实的捷径。

**定理4.3.2** 令 $\tau$ 表示 $X$ 到 $Y$ 的总体因果曲线（回归曲线）的斜率，则有
$$
\tau=E(Y\mid do(x+1))-E(Y\mid do(x))
$$
对于任意的证据 $Z = e$ ，有
$$
E(Y_{X=x}\mid Z=e)=E(Y\mid Z=e)+\tau(x-E(X\mid Z=e))\tag{4.17}
$$

这提供了一个线性模型上的反事实的直观解释， $E(Y_{X=x}\mid Z=e)$ 能够通过以下方式计算得到：首先计算证据 $e$ 条件下的 $Y$ 的最优估计 $E(Y\mid e)$ 。然后计算当 $X$ 从当前最佳估计 $E(X|Z=e)$ 转换到它的假设值 $x$ 时 $Y$ 的期望变化，并将之前 $Y$ 的最佳估计加到这个期望变化上。

从方法论上讲，定理4.3.2的重要性在于它能够让研究人员从群体数据中回到关于个体（或个体合集合）的假设问题。在接下来的章节中我们会探讨这个性质在法律和社会场景中的应用。在图4.2展示的情景中，在证据 $e=\{X=0.5,H=1,Y=1\}$ 的条件下计算了反事实 $Y_{H=2}$ 。现在来演示如何将定理4.3.2应用于计算实施后的实施效应（effect of treatment on the treated, ETT）这样的问题中：
$$
ETT=E(Y_1-Y_0\mid X=1)\tag{4.18}
$$
在式（4.17）中替换证据 $e=\{X=1\}$ ，得到
$$
\begin{aligned}
ETT&=E(Y_1\mid X=1)-E(Y_0\mid X=1)\\
&=E(Y\mid X=1)-E(Y\mid X=1)+\tau(1-E(X\mid X=1))-\tau(0-E(X\mid X=1))\\
&=\tau\\
&=b+ac=0.9
\end{aligned}
$$
换句话说，实施后的实施效应（施加于群体的 $X=1$ 的子集合）等于整个群体上的实施效应。这是线性系统中的一般性结果，可以直接从式（4.17）中得出。 $E(Y_{x+1}-Y_x\mid e)=\tau$ 个与证据 $e$ 独立。若将一个乘法（即非线性的）交互项添加到结果方程中时，情况会变得不同。例如，如果图4.1中 $X\to H$ 的箭头反转过来， $Y$ 的方程将变为
$$
Y=bX+cH+\delta XH+U_Y\tag{4.19}
$$
即有一个交与项 $\delta XH$ 被增加到等式中。 $\tau$ 会与ETT有所不同。我们将该问题留给读者作为练习来验证 $\tau-ETT$ 的差值等于 $\frac{\delta a}{1+a^2}$ （思考题4.3.2（c））。

#### 思考题

#### 4.3.2

（a）描述图4.1的参数 $a,b,c$ 如何能从非试验数据中估计得到。

（b）在图4.3的模型中，找出受教育程度对那些薪资 $Y=1$ 的个体的效应。[提示：使用定理4.3.2来计算 $E(Y_1-Y_0\mid Y=1)$ 。]

（c）估计式（4.19）描述的模型中的 $\tau$ 以及 $ETT=E(Y_1-Y_0\mid X=1)$ 。[提示：使用反事实的基本定理、式（4.5）和等式 $E(Z\mid X=x')=R_{ZX}x'$ 。]

### 4.4 反事实的实际应用

现在我们知道了如何计算反事实，进一步了解了反事实在实际应用中很有意义，并且具有启发作用。在这一节中，我们研究一些乍看起来令人困惑的问题，它们可以用前面提到的技术来解决。希望读者在这节中能够对如何应用反事实有一个更好的理解，且能够更深层次地理解为什么要使用它们。

#### 4.4.1 项目招募

**实例4.4.1** 政府正在资助一项工作培训项目，致力于让无业人员回到工作岗位。一个试点的随机试验表明这个项目是有效的，参加这个项目的人员比没有参加这个项目的人员的就业率高。因此，这个项目被批准了，政府随后招募工作人员，为任何无业人员提供免费的工作培训，鼓励失业人员参与这个项目。

你看，项目是成功的，项目培训合格人员的就业率甚至比随机试验还要高。项目开发者很满意这个结果，决定要求更多的资助。

奇怪的是，批评者声称这个项目浪费了纳税人的钱，应该被叫停。他们的推理如下：虽然这个项目在试验研究中或多或少是成功的，参与的人员也是随机选择的，但是参加项目人是那些自愿来参与的。批评者称，自愿参与项目的人比那些没有参与项目的人更灵活，有更多的资源和更多的社会关系，无论参不参与这个项目，他们都更有可能找到工作。批评者称，我们需要估计的是，项目对那些参与者的差量效益，即对于那些参与者，相比于他们当初不参加培训，就业率会有多大程度的提高。

使用下标符号来表示反事实，令 $X=1$ 表示参加培训， $Y=1$ 表示获得工作， 需要估计的量值是培训后的培训效应（ $ETT$ ，更被广泛地称为“实施后的实施效应”，即式（4.18））：
$$
ETT=E(Y_1-Y_0\mid X=1)\tag{4.20}
$$
这里差值上 $Y_1-Y_0$ 表示对一个随机选择的个体，培训（ $X$ ）对雇佣（ $Y$ ）的因果效应，条件 $X=1$ 将选择限制到那些出于自愿选择培训项目的个体。

正如 4.1 节的高速路例子那样，我们看到反事实 $Y_0$ （当初不参加培训的就业率）的前件（ $X=0$ ）和作为条件（ $X=1$ ）事件之间的冲突。高速路例子的反事实分析不能为个体的后悔陈述（“我本来应该走高速路”）提供帮助，但这里的结果有重要的经济意义，例如结束培训项目，或者可能的话重新构建招募策略，来吸引那些能够从项目中有更多收益的人员。

我们既不能从观测数据，也不能从实验数据中估计 $ETT$ 表达式的值。原因还是 $Y_0$ 的下标和条件 $X=1$ 之间的冲突。的确， $E(Y_0\mid X=1)$ 代表了一个培训的人（ $X=1$ ）如果当初不参加培训所能得到工作的期望。这个反事实期望似乎忽略了现实，因为我们永远无法回到过去，拒绝那些参与过培训的人参加培训。然而，在本章后续的章节中我们会看到，尽管有这个冲突，期望  $E(Y_0\mid X=1)$ 在许多场合下还是可被计算的，虽然不是全部场合。其中之一就是变量集合 $Z$ 满足关于实施变量和结果变量的后门准则时。在这种情况下， $ETT$ 概率可以由一个修正的校正公式得到：
$$
P(Y_x=y\mid X=x')=\sum_zP(Y=y\mid X=x,Z=z)P(Z=z\mid X=x')\tag{4.21}
$$






